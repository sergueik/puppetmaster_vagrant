fact_name = 'product_version'require 'win32/registry'        if Facter.value(:kernel) == 'windows'
  def registry_uninstall_version(product_displayname)    product_version = nil    $access = Win32::Registry::KEY_READ | 0x100 # Win32::Registry::KEY_ALL_ACCESS    $key = ''
    Win32::Registry::HKEY_LOCAL_MACHINE.open("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall", $access ) do |reg_key| ;      reg_key.each_key do |subkey|        found_name = nil        Win32::Registry::HKEY_LOCAL_MACHINE.open("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\#{subkey}", $access ) do |reg_subkey|          reg_subkey.each do |name, type, data|            if name.eql?('DisplayVersion')               product_version = data            end            if name.eql?('DisplayName')                if data == product_displayname                  found_name = true                end            end          end          if found_name            break          end        end      end    end    product_version  end
  Facter.add(fact_name) do    setcode do      filepath = 'C:\Program Files\Oracle\VirtualBox Guest Additions\VBoxControl.exe'      registry_uninstall_version('Puppet Agent (64-bit)')      # product_version '1.7.1'    end  endend  
